  if (this.type=="SWITCH") {
       cTypes.push({
        cType: types.POWER_STATE_CTYPE,
        onUpdate: function(value) {
            that.command("set","STATE" , (value==1)?true:false)
        },

        onRead: function(callback) {
            that.query("STATE",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("STATE");
        },
             
        perms: ["pw","pr","ev"],
        format: "bool",
        initialValue: that.dpvalue("STATE",0),
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Change the power state",
        designedMaxLength: 1
      });
      
      if (this.special=="OUTLET") {
        cTypes.push({
          cType: types.OUTLET_IN_USE_CTYPE,
               
          onRead: function(callback) {
           callback(true);
          },
        perms: ["pr","ev"],
        format: "bool",
        initialValue: true,
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Is Outlet in Use",
        designedMaxLength: 1
      })
     } 
    }
    
      
     if (this.type=="KEYMATIC") {
     cTypes.push(
      {
        cType: types.CURRENT_LOCK_MECHANISM_STATE_CTYPE,
        
        onRead: function(callback) {
           that.query("STATE",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("STATE");
        },

        perms: ["pr","ev"],
        format: "bool",
        initialValue: that.dpvalue("STATE",0),
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Current State of your Lock",
 		designedMaxLength: 1
      },
      {
        cType: types.TARGET_LOCK_MECHANISM_STATE_CTYPE,
        
        onUpdate: function(value) {
            that.command("set","STATE",(value==1)?"false":"true")
        },
        
        onRead: function(callback) {
           that.query("STATE",callback);
        },
        
        onRegister: function(characteristic) { 
            that.addValueMapping("STATE","1",0);
            that.addValueMapping("STATE","0",1);
            that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("STATE");
        },

        
        perms: ["pw","pr","ev"],
        format: "bool",
        initialValue: that.dpvalue("STATE",0),
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Target State of your Lock",
 		designedMaxLength: 1
      }
      
      ,
      {
        cType: types.TARGET_DOORSTATE_CTYPE,
        
         onUpdate: function(value) {
            that.command("set","OPEN" , "true")
        },

        onRead: function(callback) {
           callback(1);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["OPEN"] = characteristic;
            characteristic.eventEnabled = true;
        },
        
        perms: ["pw","pr","ev"],
        format: "bool",
        initialValue: 1,
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Open the Lock",
 		designedMaxLength: 1
      }      
      );
      
      
    }



    if (this.type=="DIMMER") {
     cTypes.push({
        cType: types.POWER_STATE_CTYPE,
        onUpdate: function(value) {
            that.command("set","LEVEL" , (value==true) ? "1" : "0")
        },

        onRead: function(callback) {
            that.query("LEVEL",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["LEVEL"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("LEVEL");
        },
        
        perms: ["pw","pr","ev"],
        format: "bool",
        initialValue: (that.dpvalue("LEVEL")>0,0),
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Change the power state",
        designedMaxLength: 1
      },
      {
        cType: types.BRIGHTNESS_CTYPE,
        onUpdate: function(value) {
          that.delayed("set","LEVEL" , String(value/100),100);
        },
        
        onRead: function(callback) {
           that.query("LEVEL",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["LEVEL"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("LEVEL");
        },

        
        perms: ["pw","pr","ev"],
        format: "int",
        initialValue: that.dpvalue("LEVEL",0),
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Adjust Brightness of Light",
        designedMinValue: 0,
        designedMaxValue: 100,
        designedMinStep: 1,
        unit: "%"
      });
    }



    if (this.type=="BLIND") {
     cTypes.push(
      {
        cType: types.WINDOW_COVERING_CURRENT_POSITION_CTYPE,
        
        onRead: function(callback) {
           that.query("LEVEL",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["LEVEL"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("LEVEL");
        },

        perms: ["pr","ev"],
        format: "int",
        initialValue: that.dpvalue("LEVEL",0),
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Current Blind Position",
        designedMinValue: 0,
        designedMaxValue: 100,
        designedMinStep: 1,
        unit: "%"
      },
      
      {
      cType: types.WINDOW_COVERING_TARGET_POSITION_CTYPE,
        
        onUpdate: function(value) {
          that.delayed("set","LEVEL" , String(value/100),100);
        },
        

        onRead: function(callback) {
           that.query("LEVEL",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["LEVEL"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("LEVEL");
        },

        perms: ["pw","pr","ev"],
        format: "int",
        initialValue: that.dpvalue("LEVEL",0),
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Target Blind Position",
        designedMinValue: 0,
        designedMaxValue: 100,
        designedMinStep: 1,
        unit: "%"
      },
      {
      cType: types.WINDOW_COVERING_OPERATION_STATE_CTYPE,
        
        onRead: function(callback) {
           that.query("DIRECTION",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["DIRECTION"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("DIRECTION");
        },

        perms: ["pr","ev"],
        format: "int",
        initialValue: that.dpvalue("DIRECTION",0),
        supportEvents: false,
        supportBonjour: false,
        manfDescription: "Operating State ",
        designedMinValue: 0,
        designedMaxValue: 2,
        designedMinStep: 1
      }
      
      );
    }
    
    // Simple Contact (Magnet)
    
    if (this.type=="SHUTTER_CONTACT") { 
	 // Marked as Door ? 
	 if (this.special == "DOOR") {
	 
	 cTypes.push(
	 	{  
	 	cType: "0000000E-0000-1000-8000-0026BB765291",
            
        onRead: function(callback) {
            that.query("STATE",callback);
        },
        
        onRegister: function(characteristic) { 
	        that.addValueMapping("STATE","true",0);
            that.addValueMapping("STATE","false",1);
			that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("STATE");
        },
      
      perms: ["pr","ev"],
      format: "int",
      initialValue: that.dpvalue("STATE",0),
      supportEvents: false,
      supportBonjour: false,
      manfDescription: "Current State ",
      designedMinValue: 0,
      designedMaxValue: 4,
      designedMinStep: 1
	 });
	 
	 
	 } else {
	 	
	 cTypes.push(
	 	{  
	 	cType: types.CONTACT_SENSOR_STATE_CTYPE,
            
        onRead: function(callback) {
            that.query("STATE",callback);
        },
        
        onRegister: function(characteristic) { 
			that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("STATE");
        },
      
      perms: ["pr","ev"],
      format: "bool",
      initialValue: that.dpvalue("STATE",0),
      supportEvents: false,
      supportBonjour: false,
      manfDescription: "Current State"
	 });
	 }
	
	}
	
	// Rotary Handle 
    if (this.type=="ROTARY_HANDLE_SENSOR") { 
	
	if (this.special == "DOOR") {
	 
	 cTypes.push(
	 	{  
	 	cType: "0000000E-0000-1000-8000-0026BB765291",
            
        onRead: function(callback) {
            that.query("STATE",callback);
        },
        
        onRegister: function(characteristic) { 
	        that.addValueMapping("STATE","0",1);
	        that.addValueMapping("STATE","1",0);
	        that.addValueMapping("STATE","2",0);
			that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("STATE");
        },
      
      perms: ["pr","ev"],
      format: "int",
      initialValue: that.dpvalue("STATE",0),
      supportEvents: false,
      supportBonjour: false,
      manfDescription: "Current State ",
      designedMinValue: 0,
      designedMaxValue: 4,
      designedMinStep: 1
	 });
	
	 } else {
	
	 cTypes.push(
	 {  
	 	cType: types.CONTACT_SENSOR_STATE_CTYPE,
            
        onRead: function(callback) {
            that.query("STATE",callback);
        },
        
        onRegister: function(characteristic) {  
            that.addValueMapping("STATE","2",1);
		    that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("STATE");
        },
      
      perms: ["pr","ev"],
      format: "bool",
      initialValue: that.dpvalue("STATE",0),
      supportEvents: false,
      supportBonjour: false,
      manfDescription: "Current State"
	 });
	}
	}
	
	// Motion Detector
	
	if (this.type=="MOTION_DETECTOR") { 
	 cTypes.push(
	 {  
	 	cType: types.MOTION_DETECTED_CTYPE,
         
        onRead: function(callback) {
            that.query("MOTION",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["MOTION"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("MOTION");
        },
      
      perms: ["pr","ev"],
      format: "bool",
      initialValue: that.dpvalue("MOTION",0),
      supportEvents: false,
      supportBonjour: false,
      manfDescription: "Current Motion State"
	 });
	}
	
	// Smoke Detector
	if (this.type=="SMOKE_DETECTOR") { 
	 cTypes.push(
	 {  
	 	cType: "00000076-0000-1000-8000-0026BB765291",
         
        onRead: function(callback) {
            that.query("STATE",callback);
        },
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("STATE");
        },
      
      perms: ["pr","ev"],
      format: "bool",
      initialValue: that.dpvalue("STATE",0),
      supportEvents: false,
      supportBonjour: false,
      manfDescription: "Smoke detected"
	 });
	}
	
	// Weather sensors

	if (this.type=="WEATHER_TRANSMIT") { 
	 cTypes.push(
	 {  
	 	cType: types.CURRENT_TEMPERATURE_CTYPE,
        onRead: function(callback) {that.query("TEMPERATURE",callback);},
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["TEMPERATURE"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("TEMPERATURE");
        },
      perms: ["pr","ev"],format: "int",initialValue: 0,supportEvents: false,
      supportBonjour: false,manfDescription: "Current Temperature Unit",unit: "celsius"
	 },

	 {  
	 	cType: types.CURRENT_RELATIVE_HUMIDITY_CTYPE,
        onRead: function(callback) {that.query("HUMIDITY",callback);},
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["HUMIDITY"] = characteristic;
            characteristic.eventEnabled = true;
            that.remoteGetValue("HUMIDITY");
        },
      perms: ["pr","ev"],format: "int",initialValue: 20,supportEvents: false,
      supportBonjour: false,manfDescription: "Current Humidity",unit: "%"
	 }
	 );
	}
	
	// Program Launcher
	if (this.type=="PROGRAM_LAUNCHER") { 
	 cTypes.push(
	 {  
	 	cType: "5E0115D7-7594-4846-AFB7-F456389E81EC",

        onRead: function(callback) {
          that.log("Reading PRG");
            callback(0);
        },
        
        onUpdate: function(value) {
         if (value==1) {
          that.command("sendregacommand","","var x=dom.GetObject(\""+that.name+"\");if (x) {x.ProgramExecute();}",function() {
           setTimeout(function(){
			   that.event("STATE",0);	
         	   }, 1000 );
          });
         }
        },    
        
        onRegister: function(characteristic) { 
            that.currentStateCharacteristic["STATE"] = characteristic;
            characteristic.eventEnabled = true;
        },

      perms: ["ev","pr","pw"],
      format: "bool",
      initialValue: 0,
      supportEvents: false,
      supportBonjour: false,
      manfDescription: "Program Launcher"
	 });
	}


	// Heating Device
	
	if ((this.type=="CLIMATECONTROL_RT_TRANSCEIVER") || (this.type=="THERMALCONTROL_TRANSMIT")) {
    
    cTypes.push(	
	{
      cType: types.CURRENTHEATINGCOOLING_CTYPE,onUpdate: null,
      onRead: function(callback) {
 		var mode = (that.state["SET_TEMPERATURE"] == 4.5)?0:1;
 		callback(mode);
      },
      
      onRegister: function(characteristic) { 
            that.currentStateCharacteristic["MODE"] = characteristic;
            characteristic.eventEnabled = true;
      },
      
      perms: ["pr","ev"],format: "int",initialValue: 1,supportEvents: false,
      supportBonjour: false,manfDescription: "Current Mode",designedMaxLength: 1,designedMinValue: 0,designedMaxValue: 1,designedMinStep: 1
    },
  
    {
      cType: types.TARGETHEATINGCOOLING_CTYPE,
      
      onRead: function(callback) {
 		var mode = (that.state["SET_TEMPERATURE"] == 4.5)?0:1;
 		callback(mode);
      },
      
      onUpdate: function(value) {
       if (value==0) {
		   that.command("setrega", "SET_TEMPERATURE", 4.5);
           that.cleanVirtualDevice("SET_TEMPERATURE");
		} else {
		   //that.command("setrega", "SET_TEMPERATURE", 21);
           that.cleanVirtualDevice("SET_TEMPERATURE");
       }      
      },
      
       onRegister: function(characteristic) { 
            that.currentStateCharacteristic["MODE"] = characteristic;
            characteristic.eventEnabled = true;
      },

      perms: ["pw","pr","ev"],
      format: "int",initialValue: 1,supportEvents: false,supportBonjour: false,manfDescription: "Target Mode",
      designedMinValue: 0,designedMaxValue: 1,designedMinStep: 1
    },
    
    {
      cType: types.CURRENT_TEMPERATURE_CTYPE,
      onUpdate: null,
              
      onRead: function(callback) {
 		that.query("ACTUAL_TEMPERATURE",callback);
      },
        
      onRegister: function(characteristic) { 
            that.currentStateCharacteristic["ACTUAL_TEMPERATURE"] = characteristic;
            characteristic.eventEnabled = true;
            that.cleanVirtualDevice("ACTUAL_TEMPERATURE");
      },
      perms: ["pw","pr","ev"], perms: ["pr"],format: "double",
      initialValue: that.dpvalue("ACTUAL_TEMPERATURE",20),
      supportEvents: false,supportBonjour: false,manfDescription: "Current Temperature",unit: "celsius"
    },
    
    {
      cType: types.TARGET_TEMPERATURE_CTYPE,
      onUpdate: function(value) {
            if (that.state["CONTROL_MODE"]!=1) {
              that.delayed("setrega", "MANU_MODE",value,500);
              that.state["CONTROL_MODE"]=1; // set to Manual Mode
            } else {
              that.delayed("setrega", "SET_TEMPERATURE", value,500);
            }
      },
      onRead: function(callback) {
			that.query("SET_TEMPERATURE",function(value) {
			 if (value<10) {
			 	value=10;
			 }
			 if (value==4.5){
				 that.currentStateCharacteristic["MODE"].updateValue(0, null);
			 } else {
			 	 that.currentStateCharacteristic["MODE"].updateValue(1, null);
			 }
			 callback(value);
			});
			
			that.query("CONTROL_MODE",undefined);
			
      },
      onRegister: function(characteristic) { 
            that.currentStateCharacteristic["SET_TEMPERATURE"] = characteristic;
            characteristic.eventEnabled = true;
            that.state["SET_TEMPERATURE"] = undefined;
            that.cleanVirtualDevice("SET_TEMPERATURE");
            that.cleanVirtualDevice("CONTROL_MODE");
      },
      perms: ["pw","pr","ev"],format: "double",
      initialValue: that.dpvalue("SET_TEMPERATURE",16),
      supportEvents: false,supportBonjour: false, manfDescription: "Target Temperature",
      designedMinValue: 10,designedMaxValue: 38,designedMinStep: 1,unit: "celsius"
    },
    
    {
      cType: types.TEMPERATURE_UNITS_CTYPE,onRead: null,
      perms: ["pr"],format: "int",initialValue: 0,supportEvents: false,
      supportBonjour: false,manfDescription: "Current Temperature Unit",unit: "celsius"
    }

   );
   }
    
	
    return cTypes
  },

  sType: function() {
  
    if (this.type=="SWITCH") {
    
     if (this.special=="OUTLET") {
      return types.OUTLET_STYPE;
     } else {
      return types.LIGHTBULB_STYPE;
     }
	}
	    
    if (this.type=="DIMMER") { 
      return types.LIGHTBULB_STYPE;
	}

    if (this.type=="BLIND") { 
      return types.WINDOW_COVERING_STYPE;
	}

    if ((this.type=="CLIMATECONTROL_RT_TRANSCEIVER") || (this.type=="THERMALCONTROL_TRANSMIT")) { 
      return types.THERMOSTAT_STYPE;
	}
	
	if ((this.type=="SHUTTER_CONTACT") || (this.type=="ROTARY_HANDLE_SENSOR")) { 
      if (this.special=="DOOR") {
          return "5243F2EA-006C-4D68-83A0-4AF6F606136C";
      } else {
	      return types.CONTACT_SENSOR_STYPE;
      }
	}
		
	if (this.type=="MOTION_DETECTOR") {
	  return types.MOTION_SENSOR_STYPE
	}


	if (this.type=="KEYMATIC") {
	  return types.LOCK_MECHANISM_STYPE
	}
	
	if (this.type=="SMOKE_DETECTOR") {
	  return "00000087-0000-1000-8000-0026BB765291";
	}


	if (this.type=="WEATHER_TRANSMIT") {
	  return types.TEMPERATURE_SENSOR_STYPE;
	}
	
	if (this.type=="PROGRAM_LAUNCHER") {
	  return "B7F46B4D-3D69-4804-8114-393F257D4039";
	}
	
  },

  getServices: function() {
    var that = this;
    
    if (this.sType()==undefined) {
     console.log(this.name + " has no Service Type .. ");
    process.exit(1);

    }
    
    var services = [{
      sType: types.ACCESSORY_INFORMATION_STYPE,
      characteristics: this.informationCharacteristics(),
    },
    {
      sType: this.sType(),
      characteristics: this.controlCharacteristics(that)
    }];
    this.log("Loaded services for " + this.name)
    return services;
  }